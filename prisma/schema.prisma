// prisma/schema.prisma

datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

enum UserType {
  member
  trainer
  system_admin
}

enum MetricType {
  heartbeat
  calories
  steps
}

enum Gender{
  MALE
  FEMALE
  OTHER
}

model User {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  password   String
  typeOfUser UserType @default(member)

  member  Member?
  trainer Trainer?
  //admin   Admin?
  
  @@index([name])
}

model Member {
  id                  Int            @id @default(autoincrement())
  userId              Int            @unique
  user                User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  dob                 DateTime
  gender              Gender
  allergies           String
  medicalConditions   String

  heartbeatGoal       Float?
  caloriesGoal        Float?
  stepsGoal           Float?
  
  healthMetrics HealthMetric[]
  sessions PTSessionOffering[]
}

model HealthMetric {
  id          Int        @id @default(autoincrement())
  metricType  MetricType
  value       Float      // The actual measurement value
  measuredAt  DateTime   @default(now())
  memberId    Int
  member      Member     @relation(fields: [memberId], references: [id], onDelete: Cascade)
  
  @@index([memberId])
  @@index([measuredAt])
}

model ClassOffering {
  id            Int        @id @default(autoincrement())
  className     String
  description   String
  scheduleTime  DateTime
  durationMins  Int
  capacity      Int

  groupClass GroupClassOffering?
  ptSession  PTSessionOffering?

  @@index([id])
}

model PTSessionOffering {
  id                Int        @id @default(autoincrement())
  goal_completed    Boolean

  memberId          Int         @unique
  member            Member      @relation(fields: [memberId], references: [id], onDelete: Cascade)
  trainerId         Int         @unique
  trainer           Trainer     @relation(fields: [trainerId], references: [id], onDelete: Cascade)
  classOffering     ClassOffering  @relation(fields: [classOfferingId], references: [id], onDelete: Cascade)

  @@index([id])
}

model GroupClassOffering {
  id                Int            @id @default(autoincrement())
  classOffering     ClassOffering  @relation(fields: [id], references: [id], onDelete: Cascade)

  @@index([id])
}

model Rooms{
  id          Int        @id @default(autoincrement())
  roomNumber  String     @unique
  capacity    Int
  location    String
}

model Trainer{
  id                Int            @id @default(autoincrement())
  isWorking         Boolean
  hourlyRate        Int
  certifications    String?
  bio               String?
  
  userId            Int            @unique
  user              User           @relation(fields: [userId], references: [id])
  sessions          PTSessionOffering[] // personal trainer
  //classes           GroupClass[]
}