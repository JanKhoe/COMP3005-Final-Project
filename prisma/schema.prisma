// prisma/schema.prisma

datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

enum UserType {
  member
  trainer
  system_admin
}

enum MetricType {
  heartbeat
  calories
  steps
}

enum Gender{
  MALE
  FEMALE
  OTHER
}

model User {
  id         Int      @id @default(autoincrement())
  name       String   @unique
  password   String
  typeOfUser UserType @default(member)

  member  Member?
  trainer Trainer?
  //admin   Admin?
  
  @@index([name])
}

model Member {
  id                  Int            @id @default(autoincrement())
  userId              Int            @unique
  user                User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  dob                 DateTime
  gender              Gender
  allergies           String
  medicalConditions   String

  heartbeatGoal       Float?
  caloriesGoal        Float?
  stepsGoal           Float?
  
  healthMetrics HealthMetric[]
  sessions PTSession[]
}

model HealthMetric {
  id          Int        @id @default(autoincrement())
  metricType  MetricType
  value       Float      // The actual measurement value
  measuredAt  DateTime   @default(now())
  memberId    Int
  member      Member     @relation(fields: [memberId], references: [id], onDelete: Cascade)
  
  @@index([memberId])
  @@index([measuredAt])
}

model Trainer{
  id                Int            @id @default(autoincrement())
  isWorking         Boolean
  hourlyRate        Int
  certifications    String?
  bio               String?
  
  userId            Int            @unique
  user              User           @relation(fields: [userId], references: [id])
  timeSlots         TimeSlot[]
  sessions          PTSession[] // personal trainer
  //classes           GroupClass[]
}

model TimeSlot{
  id                Int         @id @default(autoincrement())
  timeStart         DateTime    // no overlapping within 1 trainer schedule
  timeEnd           DateTime
  isWeekly          Boolean

  trainerId         Int         @unique
  trainer           Trainer     @relation(fields: [trainerId], references: [id], onDelete: Cascade)
  sessions          PTSession[]
}

model PTSession{
  id                Int         @id @default(autoincrement())
  goal_completed    Boolean

  memberId          Int         @unique
  member            Member      @relation(fields: [memberId], references: [id], onDelete: Cascade)
  trainerId         Int         @unique
  trainer           Trainer     @relation(fields: [trainerId], references: [id], onDelete: Cascade)
  timeSlotId        Int         @unique
  timeSlot          TimeSlot    @relation(fields: [timeSlotId], references: [id], onDelete: Cascade)
}